# 现场活动

## 监考人员标准操作流程（SOP）

### 考试前

!!! note "T-60min：启动机器并确认是否进入系统"

    1. 如果机器未开机，则执行手动开机，或者自动唤醒。在机器较多时，务必分批依次开机，以免对电源和网络造成冲击。
    2. 观察是否所有机器均进入考试系统的登录界面。如果有机器未正常进入系统，请及时通知技术人员进行处理。
    3. 寻找一台考试机，测试是否 **无法** 登录系统。

!!! note "T-30min：考生入场"

    执行常规监考流程（如检查身份）。此时明确告知考生，目前 **系统不可登录，亦不允许擅自关闭或重启计算机** 。

!!! note "T-5min：考试系统解锁"

    1. 告知考生可以按照指定的用户名、密码登录考试系统。
    2. 及时观察现场，如果考生无法登录系统，请及时通知技术人员进行处理。

### 考试中

!!! note "考生报告机器故障"

    **在处理问题前，必须先记录当前时间。**

    如问题为系统卡顿 / 黑屏，可进行如下排查：

    1. 是否显示器电源线 / 信号线接触不良或者意外断开？
    2. 是否鼠标 / 键盘没有插好？
    3. 如果按 Ctrl + Alt + F2 能进入 tty 终端，则在终端按 Ctrl+Alt+Delete 重启。
    4. 如果短按电源键能关机，则在关机后重新打开。
    5. 如以上都无效，则长按电源强制关机后重启。

    在系统再次启动后，将重启的机器编号、处理耗费的时间同时告知系统负责人、监考负责人，以便记录和后续处理（如可能加时）。  

    如有明显硬件故障，或者考生坚持要求，可向技术负责人请求更换备用机（原则上考生已产生的本地数据不会被迁移）。在获得批准后，将新旧机器编号同时告知系统负责人、监考负责人。

    除了上述规定的动作外，监考人员不应进行任何更多协助，也不要帮助考生操作计算机，尤其是不应帮助考生调试。  

### 考试后

!!! note "T-5min：告知离场须知"

    告知考生在考试结束后立刻离开，不允许关闭或者重启计算机；加时考生可以按照监考人员的指示继续考试。

!!! note "T+0min：考试结束"

    1. 在考生离开后，立刻检查所有计算机是否处于正常状态，如有异常请及时通知技术人员处理。
    2. 确认所有计算机状态恢复正常后，在考场内等待技术负责人的指示，不要先行离场。

## 监考中常见问题（FAQ）

!!! question "高分辨率的显示器上系统界面较小"

    由于技术原因，无法设置全局系统缩放。  
    用户常用的各个软件（如终端浏览器、VS Code）均可以单独缩放，通常按 Ctrl + 鼠标滚轮或者 Ctrl + 加号 / 减号进行调整。

!!! question "考生误操作打开放大镜，导致系统界面显示不全"

    按 Alt + 鼠标滚轮可控制系统全局缩放。

!!! note "常见的无法启动系统的原因"

    * `No more network devices`：无法获得网络引导配置，检查网线是否插好。
    * 进入 Windows 或其他非考试系统：检查 BIOS 引导顺序，确保从 PXE 引导（或者 U 盘插好）。
    * 控制台反复打印 `local-bottom` 等字样：无法找到引导设备，检查 U 盘是否插好。

## 技术人员标准操作流程（SOP）

下面所有的 `clush` 都是带有正确选项的 `clush` 命令的简写，如 `clush -b -lroot -gclient`（`-b` 表示合并相同输出，`-lroot` 表示用 root 用户，`-gclient` 表示访问 client group 里面的主机）。

### 考试前

!!! note "T-60min：启动机器并确认是否进入系统"

    1. 确认此时 thupxe 的自动清理模式处于开启状态（`thupxeclear=yes`）。
    1. 如果有条件，可使用 Wake on LAN 功能开机（`ether-wake` 或者 `wakeonlan`）。
    2. 在触发开机后，可通过定期检查 `clush hostname` 的输出判断已经正常启动的客户端数量。如有问题，及时通知现场监考人员处理。
    3. 检查系统时间同步是否工作：`clush timedatectl timesync-status`，并可在服务器上使用 `chronyc clients` 查看客户端状态。
    4. 在检查完成后，运行 `clush "usermod -L user"` 锁定系统。如有必要，可运行多次。

!!! note "T-5min：考试系统解锁"

    0. 确认此时 thupxe 的自动清理模式处于关闭状态（`thupxeclear=no`）。
    1. 运行 `clush "usermod -U user"` 解锁系统。如有必要，可运行多次。
    2. 可通过 `clush loginctl list-sessions` 查看当前登录会话，确认用户能够正常登录。
    3. 观察 NGINX 访问日志，确认用户可以访问代理的站点。

### 考试中

!!! note "日常监控"

    在考试中，建议保持监控如下内容：

    1. 定期运行 `clush hostname` 检测是否客户端均在线。
    2. 观察 PXE 相关文件的 NGINX 日志，观察是否有客户端非预期重启，并要求监考人员询问和反馈。
    3. 通过 `iftop` 观察各个网络接口上是否有异常流量。

!!! note "考生报告机器故障"

    接到监考员的报告后，可以检查以下内容：

    1. 如机器不能 SSH 进入，则要求监考直接重启；
    2. 否则，检查是否有占用大量 CPU 或者内存的程序，如有则尝试杀死；
    3. 否则，检查是否有进行大量 IO 的程序，以及数据分区（重点关注 `$HOME`, `/var/log` 和 `/tmp`）是否已经填满，如有则进行清理。
    4. 如均不满足，并且单次重启后依旧有问题，可以同意更换备用机。

### 考试后

!!! note "T+0min：考试结束"

    1. 对所有考试时间已经结束的考生机器执行 `clush "systemctl isolate multi-user.target"` 关闭桌面环境（**注意不要误伤加时考生**），并执行 `usermod -L "user"` 锁定用户。
    2. 在所有考生离开后，根据需要清理和收集考生文件。根据合规要求的不同，可能包括 `$HOME`, `/var/log`, 或者整个持久化状态。例如使用 `clush --rcopy $HOME --dest .` 来收集所有客户端上的 HOME 目录下的所有文件。也可以编写脚本（例如 `tar --exclude=xxx -czf xxx.tar.gz xxx`），在每个机器上完成文件收集和打包，再用 `clush --rcopy xxx.tar.gz --dest .` 收集文件。
    3. 完成收集后，确认此时 thupxe 的自动清理模式处于开启状态（`thupxeclear=yes`）。
    4. 重启所有计算机，确认均能正常开机、均还原至初始状态，有必要可联系现场监考人员协助。
    5. 根据需要，选择锁定用户、关闭桌面环境，或者关闭计算机。
    6. 告知现场监考人员可以离开。
